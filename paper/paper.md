---
title: "toughio: Pre- and post-processing Python library for TOUGH"
tags:
    - tough2
    - tough3
    - preprocessing
    - postprocessing
    - io
authors:
    - name: Keurfon Luu
      orcid: 0000-0001-7927-0019
      affiliation: 1
affiliations:
    - name: Energy Geosciences Division, Lawrence Berkeley National Laboratory, Berkeley, CA, USA
      index: 1

date: 1 April 2020
bibliography: paper.bib
---

# Statement of Need

TOUGH is a widely used general purpose numerical simulator designed for fluid and heat flows of multiphase, multicomponent fluid mixtures in porous and fractured media, which has been applied to many real-world problems such as underground geological storage, geothermal reservoir engineering or nuclear waste disposal, to name a few.

When setting up a model, the most time-consuming part is preparing the input data required to run a TOUGH simulation due to its error-prone text-based fixed-format input files and the lack of proper built-in meshing tool to model complex geological structures. In addition, TOUGH uses an integral finite-difference formulation to solve the coupled fluid and heat flow equations where the mesh is only represented as a set of elements and connections without any reference to a coordinate system usually required for post-processing with common visualization softwares (e.g. ParaView, Tecplot and VisIt).

# Summary

In the recent years, many softwares have been developed and published to address the lack of pre- and post-processing features of TOUGH family of codes, mostly in the form of Graphical User Interfaces (GUIs) such as (free) TIM [@yeh_tim_2013], TOUGH2Viewer [bondua_tough2viewer:_2012], (commercial) Leapfrog [@newson_application_2012], mView [@avis_mview_2012] or PetraSim [@yamamoto_petrasim_2008]. While GUIs provide a convenient integrated working environment since they do not require to have any programming knowledge, users are often limited to the features implemented in the softwares and pre- and post-processing outputs are hardly reproducible due to closed or proprietary formats. Besides, automation of runs or coupled simulations (e.g. with a mechanical simulator) cannot be carried out through a GUI. All of the aforementioned issues can be addressed by using a high level scripting language such as Python.

`toughio` is a lightweight, object-oriented and vectorized Python library that aims to provide user-friendly routines to facilitate pre- and post-processing of a TOUGH simulation so that scientists can focus on what to do with TOUGH rather than how to do it with TOUGH. Although its primary target is the latest version TOUGH3 [@jung_tough3_2017], `toughio` can also be used to read/write TOUGH2 [@pruess_tough2_2012] input/output files. Currently, to the best of our knowledge, only PyTOUGH [@croucher_pytough_2011] offers an exhaustive number of features to carry out a complete TOUGH simulation using a scripting language. `toughio` and PyTOUGH share the same objectives, yet with different approaches and philosophies. On the one hand, a PyTOUGH mesh is represented as a _MULGRAPH_ geometry where elements can be unstructured horizontally but only layered vertically (usually referred to as 2.5D). It also checks that the model parameters are valid to ensure that a TOUGH simulation runs smoothly. On the other hand, although it provides basic meshing features, `toughio` mostly relies on common third-party softwares (e.g. Abaqus, FLAC3D, Gmsh [@geuzaine_gmsh:_2009], LaGriT) to generate the mesh by importing and converting it to a TOUGH mesh, which also conveniently facilitates the coupling of TOUGH with any other simulator that also supports the same mesh formats. Besides, `toughio` is designed to be _just_ a TOUGH input and output file reader/writer. It assumes that the user knows what he is doing and does not verify the validity of the model parameters (`toughio` does verify the functional arguments).

Figure 1 shows the result of a sample CO<sub>2</sub> sequestration simulation where supercritical CO<sub>2</sub> is continuously injected during 3 years in a reservoir near a fault modeled as a finite-thickness element with high permeability. The model has been entirely set up using `toughio` with a mesh generated by Gmsh imported and pre-processed in Python thanks to `meshio` [@nico_schlomer_2020_3691940]. Outputs of the TOUGH simulation have been imported and directly visualized in Python thanks to `pyvista` [@sullivan_pyvista_2019].

![Example of simulation of CO<sub>2</sub> upward leakage along a fault completely developed with `toughio`. Mesh has been generated with Gmsh and imported in Python by `meshio`. Output figure has been prepared and exported by `pyvista`.](./figures/sample.png)

## References
